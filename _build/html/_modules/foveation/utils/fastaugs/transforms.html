

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>foveation.utils.fastaugs.transforms &mdash; foveation 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            foveation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../read_me.html">A biologically-inspired foveated interface for deep vision models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Example notebooks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.sensing.html">foveation.sensing package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.arch.html">foveation.arch package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.saccadenet.html">foveation.saccadenet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.trainer.html">foveation.trainer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utilities &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.utils.html">foveation.utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.demo.html">foveation.demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.paths.html">foveation.paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.probes.html">foveation.probes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/foveation.visualizer.html">foveation.visualizer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">foveation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../foveation.html">foveation</a></li>
          <li class="breadcrumb-item"><a href="../../utils.html">foveation.utils</a></li>
      <li class="breadcrumb-item active">foveation.utils.fastaugs.transforms</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for foveation.utils.fastaugs.transforms</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numbers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.nn.modules.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">_pair</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">functional</span> <span class="k">as</span> <span class="n">F</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">functional_tensor</span> <span class="k">as</span> <span class="n">FT</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># utility transforms</span>
            <span class="s1">&#39;Compose&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;RandomApply&#39;</span><span class="p">,</span> 
            
            <span class="c1"># basic ops</span>
            <span class="s1">&#39;ToTorchImage&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ToNumpy&#39;</span><span class="p">,</span> <span class="s1">&#39;ToChannelsFirst&#39;</span><span class="p">,</span> <span class="s1">&#39;ToChannelsLast&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;ToDevice&#39;</span><span class="p">,</span> <span class="s1">&#39;ToFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;ToFloatDiv&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MultiSample&#39;</span><span class="p">,</span>
            
            <span class="c1"># no random component</span>
            <span class="s1">&#39;NormalizeGPU&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CircularMask&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ToGrayscaleTorchGPU&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;ToGrayscaleGPU&#39;</span><span class="p">,</span> 
    
            <span class="c1"># randomly applied to entire batch (but with different params per image)</span>
            <span class="s1">&#39;ColorJitter&#39;</span><span class="p">,</span>
            
            <span class="c1"># randomly applied to each image in the batch</span>
            <span class="s1">&#39;RandomGaussianBlur&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RandomHorizontalFlip&#39;</span><span class="p">,</span>     
            <span class="s1">&#39;RandomGrayscale&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RandomBrightness&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;RandomContrast&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RandomSolarization&#39;</span><span class="p">,</span>  
            <span class="s1">&#39;RandomRotate&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;RandomZoom&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RandomPatchShuffle&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RandomColorJitterYIQ&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RandomColorJitter&#39;</span><span class="p">,</span>
    
            <span class="c1"># revisit</span>
            <span class="s1">&#39;RandomRotateObject&#39;</span><span class="p">,</span>
            
          <span class="p">]</span>

<span class="n">default_device</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span>

<span class="c1"># =================================================</span>
<span class="c1">#  Compose</span>
<span class="c1"># =================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">print_types</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">b_</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span> 
            <span class="n">print_types</span><span class="p">(</span><span class="n">b_</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        
<div class="viewcode-block" id="Compose">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.Compose">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Compose</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Composes several transforms together.</span>
<span class="sd">    Args:</span>
<span class="sd">        transforms (list of ``Transform`` objects): list of transforms to compose.</span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; transforms.Compose([</span>
<span class="sd">        &gt;&gt;&gt;     transforms.CenterCrop(10),</span>
<span class="sd">        &gt;&gt;&gt;     transforms.ToTensor(),</span>
<span class="sd">        &gt;&gt;&gt; ])</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Compose.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.Compose.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transforms</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span></div>

    
<div class="viewcode-block" id="Compose.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.Compose.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">apply_last</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">replay</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">apply_last</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">if</span> <span class="n">replay</span> <span class="k">else</span> <span class="n">t</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">format_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">)&#39;</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  MultiSample</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="MultiSample">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.MultiSample">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiSample</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs transforms muliple times, return multiple copies of the input.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        transforms: List of transforms</span>
<span class="sd">        num_copies: number of copies to produce / how many times to run the trasforms </span>
<span class="sd">        return_input: whether to return the input as an output (default = False)</span>
<span class="sd">        clone_input: whether to clone the input before each application of transforms (default = True)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MultiSample.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.MultiSample.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">num_copies</span><span class="p">,</span> <span class="n">return_input</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clone_input</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transforms</span><span class="p">,</span> <span class="p">(</span><span class="n">Compose</span><span class="p">,))</span> <span class="k">else</span> <span class="n">Compose</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_copies</span> <span class="o">=</span> <span class="n">num_copies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_input</span> <span class="o">=</span> <span class="n">return_input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_input</span> <span class="o">=</span> <span class="n">clone_input</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">replay</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_input</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_copies</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clone</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_input</span> <span class="k">else</span> <span class="n">b</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;num_copies=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_copies</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;, return_input=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_input</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;, clone_input=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">clone_input</span><span class="si">}</span><span class="s1">, transforms=&#39;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

        
<span class="c1"># =================================================</span>
<span class="c1">#  RandomApply</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="RandomApply">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomApply">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomApply</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly apply transforms with probability `p`</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RandomApply.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomApply.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        
<div class="viewcode-block" id="RandomApply.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomApply.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mf">1.</span> <span class="ow">or</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span></div>

        
<div class="viewcode-block" id="RandomApply.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomApply.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomApply.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomApply.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;do&#39;</span><span class="p">]:</span> 
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span> 
                <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">apply_last</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span> 
                <span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    p=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;    </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">)&#39;</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  type/device transforms</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="ToTorchImage">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToTorchImage">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToTorchImage</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ToTorchImage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="ToTorchImage.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToTorchImage.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">from_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_numpy</span> <span class="o">=</span> <span class="n">from_numpy</span></div>

        
<div class="viewcode-block" id="ToTorchImage.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToTorchImage.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

    
<div class="viewcode-block" id="ToTorchImage.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToTorchImage.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            x: Numpy Array or Torch Tensor, BHWC or HWC</span>
<span class="sd">        Returns:</span>
<span class="sd">            TorchImage: BxCxHxW tensor, values between [0,1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">to_torch_image</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">from_numpy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;(device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">, dtype=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">, from_numpy=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_numpy</span><span class="si">}</span><span class="s2">)&quot;</span></div>

    
<span class="k">class</span><span class="w"> </span><span class="nc">FromNumpy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">        Returns:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;()&#39;</span>
    
<div class="viewcode-block" id="ToNumpy">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToNumpy">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToNumpy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts the given Image to a numpy array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="ToNumpy.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToNumpy.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

    
<div class="viewcode-block" id="ToNumpy.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToNumpy.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            img (PIL Image): Image to be converted.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ArrayImage: image as numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;()&#39;</span></div>

    
<div class="viewcode-block" id="ToChannelsFirst">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToChannelsFirst">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToChannelsFirst</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts batch from BxHxWxC to BxCxHxW</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="ToChannelsFirst.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToChannelsFirst.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

    
<div class="viewcode-block" id="ToChannelsFirst.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToChannelsFirst.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            img (PIL Image): Image to be converted.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ArrayImage: image as numpy array</span>
<span class="sd">        &quot;&quot;&quot;</span>            
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">to_channels_first</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;()&#39;</span></div>

    
<div class="viewcode-block" id="ToChannelsLast">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToChannelsLast">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToChannelsLast</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts batch from BxCxHxW to BxHxWxC</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="ToChannelsLast.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToChannelsLast.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

    
<div class="viewcode-block" id="ToChannelsLast.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToChannelsLast.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            img: ArrayImage or TensorImage to be converted.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ArrayImage: image with channels_last</span>
<span class="sd">        &quot;&quot;&quot;</span>            
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">to_channels_last</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;()&#39;</span>    </div>

    
<div class="viewcode-block" id="ToDevice">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToDevice">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToDevice</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Moves tensor to device.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ToDevice.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToDevice.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span></div>

    
<div class="viewcode-block" id="ToDevice.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToDevice.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

    
<div class="viewcode-block" id="ToDevice.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToDevice.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">to_device</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;(device=&#39;</span><span class="si">{0}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>  </div>


<div class="viewcode-block" id="ToFloat">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToFloat">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToFloat</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts tensor to float using .float()</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ToFloat.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToFloat.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ToFloat.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToFloat.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

    
<div class="viewcode-block" id="ToFloat.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToFloat.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">to_float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;()&#39;</span></div>

    
<div class="viewcode-block" id="ToFloatDiv">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToFloatDiv">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToFloatDiv</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts tensor to float using division.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ToFloatDiv.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToFloatDiv.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span></div>

        
<div class="viewcode-block" id="ToFloatDiv.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToFloatDiv.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

    
<div class="viewcode-block" id="ToFloatDiv.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToFloatDiv.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">div_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(value=</span><span class="si">{0}</span><span class="s1">, dtype=</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span></div>

    
    
<span class="c1"># =================================================</span>
<span class="c1">#  Normalize</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="NormalizeGPU">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.NormalizeGPU">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NormalizeGPU</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;x = (x - mean) / std&quot;&quot;&quot;</span>

<div class="viewcode-block" id="NormalizeGPU.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.NormalizeGPU.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">default_device</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">std</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inplace</span> <span class="o">=</span> <span class="n">inplace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">default_device</span> </div>

    
<div class="viewcode-block" id="NormalizeGPU.op">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.NormalizeGPU.op">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">std</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inplace</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="NormalizeGPU.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.NormalizeGPU.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span></div>

    
<div class="viewcode-block" id="NormalizeGPU.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.NormalizeGPU.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span></div>

    
<div class="viewcode-block" id="NormalizeGPU.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.NormalizeGPU.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;mean=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;, std=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;, inplace=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inplace</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">return</span> <span class="n">format_string</span></div>


<span class="c1"># =================================================</span>
<span class="c1">#  RandomGaussianBlur</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="RandomGaussianBlur">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGaussianBlur">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomGaussianBlur</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gaussian blur augmentation in SimCLR https://arxiv.org/abs/2002.05709&quot;&quot;&quot;</span>
<div class="viewcode-block" id="RandomGaussianBlur.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGaussianBlur.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sigma_range</span><span class="o">=</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span> <span class="n">num_sigmas</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">=</span> <span class="n">_pair</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_range</span> <span class="o">=</span> <span class="n">sigma_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_sigmas</span> <span class="o">=</span> <span class="n">num_sigmas</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">sigma_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigma_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_sigmas</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gaussian_kernels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_gaussian_kernel1d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="n">ksize_half</span> <span class="o">=</span> <span class="p">(</span><span class="n">kernel_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">ksize_half</span><span class="p">,</span> <span class="n">ksize_half</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">kernel_size</span><span class="p">)</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">kernel1d</span> <span class="o">=</span> <span class="n">pdf</span> <span class="o">/</span> <span class="n">pdf</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">kernel1d</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_gaussian_kernel2d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="n">kernel1d_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gaussian_kernel1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">kernel1d_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gaussian_kernel1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">kernel2d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">kernel1d_y</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">kernel1d_x</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">return</span> <span class="n">kernel2d</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_gaussian_kernels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">):</span>
        <span class="c1"># Define the size of the kernel</span>
        <span class="c1"># Generate kernel for each sigma</span>
        <span class="n">kernels</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_gaussian_kernel2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">,</span> <span class="n">_pair</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span> <span class="k">for</span> <span class="n">sigma</span> <span class="ow">in</span> <span class="n">sigmas</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">kernels</span><span class="p">)</span>
    
<div class="viewcode-block" id="RandomGaussianBlur.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGaussianBlur.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        
        <span class="c1"># which images to blur</span>
        <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_batch</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        
        <span class="c1"># which kernel to use for each to-be-blurred image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_kernels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> 
                                              <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        
        <span class="c1"># make sure the kernels are on the same device as batch</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="RandomGaussianBlur.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGaussianBlur.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;selected_kernels&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_kernels</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomGaussianBlur.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGaussianBlur.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_gaussian_blur2d</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;selected_kernels&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_gaussian_blur2d</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_kernels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">param_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(p=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s1">, kernel_size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="si">}</span><span class="s1">, sigma_range=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_range</span><span class="si">}</span><span class="s1">, num_sigma=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_sigmas</span><span class="si">}</span><span class="s1">, seed=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="n">param_str</span></div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  Instance Sampler</span>
<span class="c1"># =================================================</span>

<span class="k">class</span><span class="w"> </span><span class="nc">InstanceSamplesTransform</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;transform input `n_samples` times&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_transform</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_transform</span> <span class="o">=</span> <span class="n">base_transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">samples</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(n_samples=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_transform</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">text</span>
    
<span class="c1"># =================================================</span>
<span class="c1">#  ColorJitter</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="ColorJitter">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ColorJitter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ColorJitter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Random apply (at batch level) jitter to the hue, saturation, value (aka brightness), and contrast of an RGB image or batch.</span>
<span class="sd">    </span>
<span class="sd">    Parameters are stored for easy replay.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability that jitter should be applied. If input is a batch, the p operates at the batch level</span>
<span class="sd">                   (i.e., either all images are jittered, or none, with probability p). Also, if jitter is applied,</span>
<span class="sd">                   each property is jittered by a random value in the range specified (see below for how to set </span>
<span class="sd">                   range for each property).</span>
<span class="sd">        </span>
<span class="sd">        hue (float or tuple of python:float (min, max)) – range over which to jitter hue</span>
<span class="sd">            Should have -.5 &lt; hue &lt; .5</span>
<span class="sd">            hue_factor is chosen uniformly from [-hue, hue] or the given [min, max]. </span>
<span class="sd">            hue=0 for no change, hue=(-.5,.5) maximum color randomization.</span>
<span class="sd">            </span>
<span class="sd">        saturation (float or tuple of python:float (min, max)) – range over which to jitter saturation. </span>
<span class="sd">            saturation_factor is chosen uniformly from [max(0, 1 - saturation), 1 + saturation] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers.</span>
<span class="sd">        </span>
<span class="sd">        value (float or tuple of python:float (min, max)) – range over which to jitter value / brightness. </span>
<span class="sd">            value_factor is chosen uniformly from [max(0, 1 - value), 1 + value] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers. </span>
<span class="sd">            </span>
<span class="sd">        contrast (float or tuple of python:float (min, max)) – range over which to jitter contrast in RGB. </span>
<span class="sd">            contrast_factor is chosen uniformly from [max(0, 1 - contrast), 1 + contrast] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers.  </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ColorJitter.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ColorJitter.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="s1">&#39;hue&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                                     <span class="n">clip_first_on_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saturation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">saturation</span><span class="p">,</span> <span class="s1">&#39;saturation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">contrast</span><span class="p">,</span> <span class="s1">&#39;contrast&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

            
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)),</span> <span class="n">clip_first_on_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If </span><span class="si">{}</span><span class="s2"> is a single number, it must be non negative.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">center</span> <span class="o">-</span> <span class="n">value</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">clip_first_on_zero</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> values should be between </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> should be a single number or a list/tuple with lenght 2.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="c1"># if value is 0 or (1., 1.) for brightness/contrast/saturation</span>
        <span class="c1"># or (0., 0.) for hue, do nothing</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">center</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">value</span>            
    
<div class="viewcode-block" id="ColorJitter.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ColorJitter.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span>
            <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="p">}</span></div>

    
<div class="viewcode-block" id="ColorJitter.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ColorJitter.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">FT</span><span class="o">.</span><span class="n">color_jitter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;do&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">b</span></div>

    
<div class="viewcode-block" id="ColorJitter.sample_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ColorJitter.sample_params">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_params</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">contrast</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hue_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">hue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hue</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>
            <span class="c1">#hue_factor.mul_(FT.M_PI).div_(180)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hue_factor</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># skip adjust_hue</span>
        
        <span class="k">if</span> <span class="n">saturation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">saturation_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">saturation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">saturation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">saturation_factor</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># skip adjust_saturation</span>
            
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_factor</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># skip adjust_value (brightness)</span>
        
        <span class="k">if</span> <span class="n">contrast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contrast_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contrast</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contrast_factor</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># skip adjust_constrast</span>
        
        <span class="k">return</span> <span class="n">hue_factor</span><span class="p">,</span> <span class="n">saturation_factor</span><span class="p">,</span> <span class="n">value_factor</span><span class="p">,</span> <span class="n">contrast_factor</span></div>

    
<div class="viewcode-block" id="ColorJitter.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ColorJitter.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">==</span><span class="mf">1.</span> <span class="ow">or</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">h</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_params</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saturation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;h&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">c</span>
        
        <span class="k">if</span> <span class="s1">&#39;mask&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>

            
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            b (TensorImage or ArrayImage): Image or batch of Images to be jittered.</span>

<span class="sd">        kwargs (optional, to override random draw with desired parameters):</span>
<span class="sd">            h (float or list of float): hue, overrides random draw; </span>
<span class="sd">            s (float or list of float): saturation, overrides random draw</span>
<span class="sd">            v (float or list of float): value, overrides random draw</span>
<span class="sd">            c (float or list of float): contrast, overrides random draw</span>
<span class="sd">            mask (tensor same size as batch, boolean): True locations in mask are not jittered</span>
<span class="sd">            If a kwarg is passed, the transform is always performed.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Image or batch of Images with hue, sat, val, contrast jittered with</span>
<span class="sd">            different random params for each individual image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FT</span><span class="o">.</span><span class="n">color_jitter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="k">else</span> <span class="n">b</span>        
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, hue=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, saturation=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saturation</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, value=</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, contrast=</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_string</span></div>



<span class="c1"># =================================================</span>
<span class="c1">#  RandomColorJitter</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="RandomColorJitter">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomColorJitter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly apply (per image) jitter to the hue, saturation, value (aka brightness), and contrast of an RGB image or batch.</span>
<span class="sd">    </span>
<span class="sd">    Parameters are stored for easy replay.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability that jitter should be applied. If input is a batch, the p operates at the batch level</span>
<span class="sd">                   (i.e., either all images are jittered, or none, with probability p). Also, if jitter is applied,</span>
<span class="sd">                   each property is jittered by a random value in the range specified (see below for how to set </span>
<span class="sd">                   range for each property).</span>
<span class="sd">        </span>
<span class="sd">        hue (float or tuple of python:float (min, max)) – range over which to jitter hue</span>
<span class="sd">            Should have -.5 &lt; hue &lt; .5</span>
<span class="sd">            hue_factor is chosen uniformly from [-hue, hue] or the given [min, max]. </span>
<span class="sd">            hue=0 for no change, hue=(-.5,.5) maximum color randomization.</span>
<span class="sd">            </span>
<span class="sd">        saturation (float or tuple of python:float (min, max)) – range over which to jitter saturation. </span>
<span class="sd">            saturation_factor is chosen uniformly from [max(0, 1 - saturation), 1 + saturation] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers.</span>
<span class="sd">        </span>
<span class="sd">        value (float or tuple of python:float (min, max)) – range over which to jitter value / brightness. </span>
<span class="sd">            value_factor is chosen uniformly from [max(0, 1 - value), 1 + value] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers. </span>
<span class="sd">            </span>
<span class="sd">        contrast (float or tuple of python:float (min, max)) – range over which to jitter contrast in RGB. </span>
<span class="sd">            contrast_factor is chosen uniformly from [max(0, 1 - contrast), 1 + contrast] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers.  </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RandomColorJitter.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitter.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="s1">&#39;hue&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                                     <span class="n">clip_first_on_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saturation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">saturation</span><span class="p">,</span> <span class="s1">&#39;saturation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">contrast</span><span class="p">,</span> <span class="s1">&#39;contrast&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

            
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)),</span> <span class="n">clip_first_on_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If </span><span class="si">{}</span><span class="s2"> is a single number, it must be non negative.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">center</span> <span class="o">-</span> <span class="n">value</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">clip_first_on_zero</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> values should be between </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> should be a single number or a list/tuple with lenght 2.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="c1"># if value is 0 or (1., 1.) for brightness/contrast/saturation</span>
        <span class="c1"># or (0., 0.) for hue, do nothing</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">center</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">value</span>            
    
<div class="viewcode-block" id="RandomColorJitter.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitter.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span>
            <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span>
            <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
        <span class="p">}</span></div>

        
<div class="viewcode-block" id="RandomColorJitter.sample_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitter.sample_params">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_params</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">contrast</span><span class="p">,</span> <span class="n">generator</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hue_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">hue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hue</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hue_factor</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># skip adjust_hue</span>
        
        <span class="k">if</span> <span class="n">saturation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">saturation_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">saturation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">saturation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">saturation_factor</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># skip adjust_saturation</span>
            
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_factor</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># skip adjust_value (brightness)</span>
        
        <span class="k">if</span> <span class="n">contrast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contrast_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contrast</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contrast_factor</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># skip adjust_constrast</span>
        
        <span class="k">return</span> <span class="n">hue_factor</span><span class="p">,</span> <span class="n">saturation_factor</span><span class="p">,</span> <span class="n">value_factor</span><span class="p">,</span> <span class="n">contrast_factor</span></div>

    
<div class="viewcode-block" id="RandomColorJitter.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitter.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_batch</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_params</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saturation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="RandomColorJitter.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitter.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">FT</span><span class="o">.</span><span class="n">random_color_jitter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            b (TensorImage or ArrayImage): Image or batch of Images to be jittered.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Image or batch of Images with hue, sat, val, contrast jittered with</span>
<span class="sd">            different random params for each individual image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FT</span><span class="o">.</span><span class="n">random_color_jitter</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>    
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, hue=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, saturation=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saturation</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, value=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, contrast=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, seed=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomColorJitterYIQ</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="RandomColorJitterYIQ">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitterYIQ">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomColorJitterYIQ</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly change the hue, saturation, and value of an image using a Yiq conversion</span>
<span class="sd">    for computational efficiency. Brightness and contrast jitter can be applied on the resulting RGB.</span>
<span class="sd">    </span>
<span class="sd">    It&#39;s expected that you will do either Yiq value jitter or RGB brightness jitter, but not both.</span>
<span class="sd">    </span>
<span class="sd">    The transformation matrix is created like so, so we get all of these operations in 1 step:</span>
<span class="sd">    mat = mat3(brightness) @ mat3(contrast) @ Yiq2Rgb @ hue_mat(h) @ sat_mat(s) @ val_mat(v) @ Rgb2Yiq</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        p (float): probability that jitter should be applied.</span>
<span class="sd">        </span>
<span class="sd">        hue (float or tuple of python:float (min, max)) – range over which to jitter hue</span>
<span class="sd">            Should have 0&lt;= hue &lt;= 180 or -180 &lt;= min &lt;= max &lt;= 180.            </span>
<span class="sd">            hue_factor is chosen uniformly from [-hue, hue] or the given [min, max]. </span>
<span class="sd">            hue=0 for no change, hue=(-180,180) maximum color randomization.</span>
<span class="sd">            </span>
<span class="sd">        saturation (float or tuple of python:float (min, max)) – range over which to jitter saturation. </span>
<span class="sd">            saturation_factor is chosen uniformly from [max(0, 1 - saturation), 1 + saturation] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers.</span>
<span class="sd">        </span>
<span class="sd">        value (float or tuple of python:float (min, max)) – range over which to jitter brightness in YiQ. </span>
<span class="sd">            brightness_factor is chosen uniformly from [max(0, 1 - brightness), 1 + brightness] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers. </span>
<span class="sd">            </span>
<span class="sd">        brightness (float or tuple of python:float (min, max)) – range over which to jitter brightness in RGB. </span>
<span class="sd">            brightness_factor is chosen uniformly from [max(0, 1 - brightness), 1 + brightness] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers.            </span>
<span class="sd">            </span>
<span class="sd">        contrast (float or tuple of python:float (min, max)) – range over which to jitter brightness in RGB. </span>
<span class="sd">            brightness_factor is chosen uniformly from [max(0, 1 - brightness), 1 + brightness] or the given [min, max]. </span>
<span class="sd">            Should be non negative numbers.                      </span>
<span class="sd">                </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RandomColorJitterYIQ.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitterYIQ.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.80</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">saturation</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">brightness</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="s1">&#39;hue&#39;</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">180.</span><span class="p">,</span> <span class="mf">180.</span><span class="p">),</span>
                                     <span class="n">clip_first_on_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saturation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">saturation</span><span class="p">,</span> <span class="s1">&#39;saturation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">brightness</span><span class="p">,</span> <span class="s1">&#39;brightness&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_input</span><span class="p">(</span><span class="n">contrast</span><span class="p">,</span> <span class="s1">&#39;contrast&#39;</span><span class="p">)</span>        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">device</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_init_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)),</span> <span class="n">clip_first_on_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If </span><span class="si">{}</span><span class="s2"> is a single number, it must be non negative.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">center</span> <span class="o">-</span> <span class="n">value</span><span class="p">,</span> <span class="n">center</span> <span class="o">+</span> <span class="n">value</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">clip_first_on_zero</span><span class="p">:</span>
                <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> values should be between </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bound</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> should be a single number or a list/tuple with lenght 2.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="c1"># if value is 0 or (1., 1.) for brightness/contrast/saturation</span>
        <span class="c1"># or (0., 0.) for hue, do nothing</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">center</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">value</span>            
    
<div class="viewcode-block" id="RandomColorJitterYIQ.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitterYIQ.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span>
            <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span>
            <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
            <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
            <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomColorJitterYIQ.sample_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitterYIQ.sample_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">hue</span><span class="p">,</span> <span class="n">saturation</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">brightness</span><span class="p">,</span> <span class="n">contrast</span><span class="p">):</span>        
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;b=batch; n=number to generate;&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hue_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">hue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hue</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hue_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">saturation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">saturation_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">saturation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">saturation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">saturation_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">brightness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">brightness_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">brightness</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">brightness</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">brightness_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">contrast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contrast_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="n">contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">contrast</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contrast_factor</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">hue_factor</span><span class="p">,</span> <span class="n">saturation_factor</span><span class="p">,</span> <span class="n">value_factor</span><span class="p">,</span> <span class="n">brightness_factor</span><span class="p">,</span> <span class="n">contrast_factor</span></div>

        
<div class="viewcode-block" id="RandomColorJitterYIQ.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitterYIQ.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `batch`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>                
        
        <span class="n">h</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_params</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saturation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span></div>

        
<div class="viewcode-block" id="RandomColorJitterYIQ.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomColorJitterYIQ.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_hsv_jitter2</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            b (TensorImage or ArrayImage): Image or batch of Images to be jittered.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Image or batch of Images with hue, sat, val jittered with</span>
<span class="sd">            different random params for each individual image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_hsv_jitter2</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, hue=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hue</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, saturation=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saturation</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, value=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, brightness=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brightness</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, contrast=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contrast</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, seed=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

        
<span class="c1"># =================================================</span>
<span class="c1">#  ToGrayscaleGPU</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="ToGrayscaleGPU">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToGrayscaleGPU">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToGrayscaleGPU</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert image to Grayscale</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ToGrayscaleGPU.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToGrayscaleGPU.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_output_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span> <span class="o">=</span> <span class="n">num_output_channels</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">to_grayscale</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">num_output_channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(num_output_channels=</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span><span class="p">)</span> </div>


<div class="viewcode-block" id="ToGrayscaleTorchGPU">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToGrayscaleTorchGPU">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ToGrayscaleTorchGPU</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert image to Grayscale</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ToGrayscaleTorchGPU.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.ToGrayscaleTorchGPU.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_output_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span> <span class="o">=</span> <span class="n">num_output_channels</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FT</span><span class="o">.</span><span class="n">rgb_to_grayscale</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">num_output_channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(num_output_channels=</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span><span class="p">)</span> </div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomGrayscale</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="RandomGrayscale">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGrayscale">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomGrayscale</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert image to Grayscale</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RandomGrayscale.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGrayscale.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">num_output_channels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span> <span class="o">=</span> <span class="n">num_output_channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        
<div class="viewcode-block" id="RandomGrayscale.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGrayscale.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_batch</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="RandomGrayscale.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGrayscale.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomGrayscale.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomGrayscale.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_grayscale</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],</span> <span class="n">num_output_channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>        
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_grayscale</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="n">num_output_channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;(p=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="si">}</span><span class="s1">, num_output_channels=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_output_channels</span><span class="si">}</span><span class="s1">, seed=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="si">}</span><span class="s1">)&#39;</span></div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomBrightness</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="RandomBrightness">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomBrightness">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomBrightness</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly Adjust Brightness with probability `p`, with scale_factor drawn</span>
<span class="sd">        uniformly between `scale_range`=[min,max] separately for each image in a batch,</span>
<span class="sd">        clamping at maximum brightness `max_value`.</span>
<span class="sd">        </span>
<span class="sd">        new_img = img * scale_factor</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RandomBrightness.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomBrightness.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale_range</span><span class="o">=</span><span class="p">(</span><span class="mf">.6</span><span class="p">,</span><span class="mf">1.4</span><span class="p">),</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span> <span class="o">=</span> <span class="n">scale_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">max_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        
<div class="viewcode-block" id="RandomBrightness.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomBrightness.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;determine whether to `do` transform, and scale_factor `sf` for each image in batch `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_batch</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">))</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="RandomBrightness.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomBrightness.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;get parameters from last random draw&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;sf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomBrightness.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomBrightness.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;apply last parameters from last random draw to batch `b`&#39;&#39;&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_adjust_brightness</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">],</span> <span class="n">idx</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],</span> <span class="n">max_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            b (TensorImage or ArrayImage): Image or batch of Images to be jittered.</span>

<span class="sd">        kwargs (optional, to override random draw with desired parameters):</span>
<span class="sd">            sf (float or list of float): scale_factors, overrides random draw performed in before_call; </span>
<span class="sd">            If a kwarg is passed, the transform is always performed.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Image or batch of Images with brightness adjusted.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_last</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, scale_range=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, max_value=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, seed=</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomContrast</span>
<span class="c1"># =================================================    </span>

<div class="viewcode-block" id="RandomContrast">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomContrast">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomContrast</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly Adjust Contrast with probability `p`, with scale_factor drawn</span>
<span class="sd">        uniformly between `scale_range`=[min,max] separately for each image in a batch,</span>
<span class="sd">        clamping at maximum brightness `max_value`.</span>
<span class="sd">        </span>
<span class="sd">        new_img = (1-scale_factor)*img.mean() - (scale_factor) * img</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RandomContrast.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomContrast.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scale_range</span><span class="o">=</span><span class="p">(</span><span class="mf">.6</span><span class="p">,</span><span class="mf">1.4</span><span class="p">),</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span> <span class="o">=</span> <span class="n">scale_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">max_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        
<div class="viewcode-block" id="RandomContrast.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomContrast.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;determine whether to `do` transform, and scale_factor `sf` for each image in batch `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_batch</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sf</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">))</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="RandomContrast.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomContrast.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;get parameters from last random draw&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;sf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomContrast.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomContrast.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;apply last parameters from last random draw to batch `b`&#39;&#39;&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_adjust_contrast</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">],</span> <span class="n">idx</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],</span> <span class="n">max_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            b (TensorImage or ArrayImage): Image or batch of Images to be jittered.</span>

<span class="sd">        kwargs (optional, to override random draw with desired parameters):</span>
<span class="sd">            sf (float or list of float): scale_factors, overrides random draw performed in before_call; </span>
<span class="sd">            If a kwarg is passed, the transform is always performed.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Image or batch of Images with brightness adjusted.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_last</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, scale_range=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, max_value=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, seed=</span><span class="si">{0}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

    

    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomHorizontalFlip</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="RandomHorizontalFlip">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomHorizontalFlip">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomHorizontalFlip</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flip the input horizontally around the y-axis with probability `p`.</span>
<span class="sd">    </span>
<span class="sd">    Works for a single TensorImage or TensorBatch, on cpu or gpu,</span>
<span class="sd">    with flipping deteremined and applied separately for each individual image.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>
<span class="sd">    </span>
<span class="sd">    Targets:</span>
<span class="sd">        TensorImage, TensorBatch</span>
<span class="sd">        </span>
<span class="sd">        Not applied to ArrayImage or ArrayBatch because we rely on PyTorch grid_sample,</span>
<span class="sd">        which only works for tensors.</span>
<span class="sd">        </span>
<span class="sd">        For ArrayImage or ArrayBatch use albumentations HorizontalFlip.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
<div class="viewcode-block" id="RandomHorizontalFlip.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomHorizontalFlip.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;`p` is the probability that each image is flipped&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        
<div class="viewcode-block" id="RandomHorizontalFlip.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomHorizontalFlip.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_tensor</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flip_val</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span>
        
        <span class="k">if</span> <span class="s1">&#39;flip_val&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flip_val</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flip_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flip_val</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">_prepare_mat</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">flip_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flip_val</span><span class="p">))</span></div>

        
<div class="viewcode-block" id="RandomHorizontalFlip.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomHorizontalFlip.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;flip_val&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip_val</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomHorizontalFlip.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomHorizontalFlip.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">affine_transform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">])</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">affine_transform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(p=</span><span class="si">{0}</span><span class="s1">, seed=</span><span class="si">{1}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span> </div>

    
    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomRotate</span>
<span class="c1"># =================================================    </span>

<div class="viewcode-block" id="RandomRotate">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomRotate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly rotate image around a point.</span>
<span class="sd">    </span>
<span class="sd">    Works for a single TensorImage or TensorBatch, on cpu or gpu,</span>
<span class="sd">    with flipping deteremined and applied separately for each individual image.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>
<span class="sd">        max_deg (float): maximum rotation angle</span>
<span class="sd">        angles (optional list of possible rotation angles): e.g., [-45, -30, -15, 0, 15, 30, 45]</span>
<span class="sd">        </span>
<span class="sd">    Targets:</span>
<span class="sd">        TensorImage, TensorBatch</span>
<span class="sd">        </span>
<span class="sd">        Not applied to ArrayImage or ArrayBatch because we rely on PyTorch grid_sample,</span>
<span class="sd">        which only works for tensors.</span>
<span class="sd">        </span>
<span class="sd">        For ArrayImage or ArrayBatch use albumentations HorizontalFlip.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
<div class="viewcode-block" id="RandomRotate.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotate.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">max_deg</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad_mode</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            `p` is the probability that each image is rotated            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_deg</span> <span class="o">=</span> <span class="n">max_deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span> <span class="k">if</span> <span class="n">angles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span> <span class="o">=</span> <span class="n">pad_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        
<div class="viewcode-block" id="RandomRotate.draw_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotate.draw_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_tensor</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deg</span><span class="p">,</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">_prepare_mat</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rotate_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="s2">&quot;xs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;ys&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomRotate.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotate.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_params</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;deg&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;deg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;xs&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;ys&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ys&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">_prepare_mat</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rotate_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">))</span></div>

        
<div class="viewcode-block" id="RandomRotate.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotate.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="s2">&quot;xs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;ys&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomRotate.replay">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotate.replay">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">replay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">affine_transform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">],</span> <span class="n">pad_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">affine_transform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">,</span> <span class="n">pad_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, max_deg=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_deg</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, angles=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, x_range=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, y_range=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s2">&quot;, pad_mode=&#39;</span><span class="si">{0}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_string</span>    </div>

    
    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomZoomGPU</span>
<span class="c1"># ================================================= </span>

<div class="viewcode-block" id="RandomZoom">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomZoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomZoom</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly zoom image around a point.</span>
<span class="sd">    </span>
<span class="sd">    Works for a single TensorImage or TensorBatch, on cpu or gpu,</span>
<span class="sd">    with zoom deteremined and applied separately for each individual image.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>
<span class="sd">    </span>
<span class="sd">    Targets:</span>
<span class="sd">        TensorImage, TensorBatch</span>
<span class="sd">        </span>
<span class="sd">        Not applied to ArrayImage or ArrayBatch because we rely on PyTorch grid_sample,</span>
<span class="sd">        which only works for tensors.</span>
<span class="sd">        </span>
<span class="sd">        For ArrayImage or ArrayBatch use albumentations.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
<div class="viewcode-block" id="RandomZoom.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomZoom.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">x</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">pad_mode</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            p is the probability that each image is rotated</span>
<span class="sd">            x,y determine the focal point for the zoom operation, between [0,1]</span>
<span class="sd">                can be an int or float, in which case the range for x is (x,x),</span>
<span class="sd">                and the range for y is (y,y), or it can be a list/tuple specifying</span>
<span class="sd">                the range x=(left,right), y=(top,bottom)</span>
<span class="sd">                </span>
<span class="sd">                Default is x=.5, y=.5, which focuses the zoom at the center of the image.</span>
<span class="sd">                To randomly zoom on different points set x=(0,1), y=(0,1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="n">zoom</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">zoom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span> <span class="o">=</span> <span class="n">pad_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>        
        
<div class="viewcode-block" id="RandomZoom.draw_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomZoom.draw_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_tensor</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">_prepare_mat</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">zoom_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;zoom&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="s2">&quot;xs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;ys&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomZoom.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomZoom.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_params</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;zoom&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;zoom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;xs&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;ys&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ys&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">_prepare_mat</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">zoom_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">))</span></div>

        
<div class="viewcode-block" id="RandomZoom.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomZoom.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;zoom&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="s2">&quot;xs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;ys&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomZoom.replay">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomZoom.replay">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">replay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">affine_transform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">],</span> <span class="n">pad_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">affine_transform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">,</span> <span class="n">pad_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, zoom=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoom_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, x=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, y=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s2">&quot;, pad_mode=&#39;</span><span class="si">{0}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

        
    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomRotateObject</span>
<span class="c1"># ================================================= </span>

<div class="viewcode-block" id="RandomRotateObject">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotateObject">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomRotateObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly rotate, rescale, and re-position an object.</span>
<span class="sd">    </span>
<span class="sd">    Works for a single TensorImage or TensorBatch, on cpu or gpu,</span>
<span class="sd">    with parameters deteremined and applied separately for each individual image.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>
<span class="sd">    </span>
<span class="sd">    Targets:</span>
<span class="sd">        TensorImage, TensorBatch</span>
<span class="sd">        </span>
<span class="sd">        Not applied to ArrayImage or ArrayBatch because we rely on PyTorch grid_sample,</span>
<span class="sd">        which only works for tensors.</span>
<span class="sd">        </span>
<span class="sd">        For ArrayImage or ArrayBatch use albumentations HorizontalFlip.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
<div class="viewcode-block" id="RandomRotateObject.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotateObject.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">max_deg</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ctr_x</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">ctr_y</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">),</span> 
                 <span class="n">dest_x</span><span class="o">=</span><span class="p">(</span><span class="mf">.25</span><span class="p">,</span><span class="mf">.75</span><span class="p">),</span> <span class="n">dest_y</span><span class="o">=</span><span class="p">(</span><span class="mf">.25</span><span class="p">,</span><span class="mf">.75</span><span class="p">),</span> <span class="n">pad_mode</span><span class="o">=</span><span class="s1">&#39;border&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                  p: the probability that each image is rotated</span>
<span class="sd">            max_deg: maximum angle of rotation (+/- max_deg)</span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_deg</span> <span class="o">=</span> <span class="n">max_deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cx_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctr_x</span><span class="p">,</span> <span class="n">ctr_x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctr_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ctr_x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cy_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctr_y</span><span class="p">,</span> <span class="n">ctr_y</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ctr_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ctr_y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destx_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">dest_x</span><span class="p">,</span> <span class="n">dest_x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dest_x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desty_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">dest_y</span><span class="p">,</span> <span class="n">dest_y</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dest_y</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span> <span class="o">=</span> <span class="n">pad_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>        
        
<div class="viewcode-block" id="RandomRotateObject.draw_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotateObject.draw_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_tensor</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deg</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cx_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">)</span><span class="o">*</span><span class="mf">.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cy_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">)</span><span class="o">*</span><span class="mf">.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest_x</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destx_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">destx_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">)</span><span class="o">*</span><span class="mf">.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest_y</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">desty_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">desty_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">)</span><span class="o">*</span><span class="mf">.5</span>
        
        <span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">rotate_object_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest_y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">_prepare_mat</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="s2">&quot;xs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;ys&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomRotateObject.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotateObject.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_params</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;deg&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;deg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;xs&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;ys&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ys&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;scale&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;dest_x&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dest_x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;dest_y&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dest_y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
            <span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">rotate_object_mat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest_y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">_prepare_mat</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="RandomRotateObject.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotateObject.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;deg&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="s2">&quot;xs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="s2">&quot;ys&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomRotateObject.replay">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomRotateObject.replay">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">replay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">affine_transform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mat&#39;</span><span class="p">],</span> <span class="n">pad_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">affine_transform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">,</span> <span class="n">pad_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, max_deg=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_deg</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, ctr_x=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cx_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, ctr_y=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cy_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, scale=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cy_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;,</span><span class="se">\n\t\t</span><span class="s1">      dest_x=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destx_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, dest_y=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">desty_range</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s2">&quot;, pad_mode=&#39;</span><span class="si">{0}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_string</span></div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  Circular Mask</span>
<span class="c1"># =================================================     </span>

<span class="k">def</span><span class="w"> </span><span class="nf">cart2pol</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">pol2cart</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<div class="viewcode-block" id="CircularMask">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.CircularMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CircularMask</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply a circular mask to each image.</span>
<span class="sd">    </span>
<span class="sd">        Works for a single TensorImage or TensorBatch, on cpu or gpu.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
<div class="viewcode-block" id="CircularMask.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.CircularMask.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">blur_span</span><span class="o">=</span><span class="mf">24.0</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">.0005</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="n">_pair</span><span class="p">(</span><span class="n">output_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blur_span</span> <span class="o">=</span> <span class="n">blur_span</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span>
        <span class="c1"># self.blank = Image.new(&quot;RGB&quot;, self.output_size, 0)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gen_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_size</span><span class="p">)</span></div>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">blur_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_span</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_gen_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_size</span><span class="p">):</span>
        <span class="n">blur_span</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blur_span</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="n">zero</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        
        <span class="c1"># get the distance of each pixel from the center</span>
        <span class="n">y_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">output_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="n">x_vals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">output_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">y_vals</span><span class="p">,</span> <span class="n">x_vals</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
        <span class="n">rho</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">cart2pol</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x_vals</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">y</span><span class="o">-</span><span class="n">y_vals</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        
        <span class="c1"># create a normal distribution with std that scales from `max` to</span>
        <span class="c1"># zero (within `tol`) over the span `blur_span`</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">blur_span</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">normal</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">blur_span</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="o">/</span> <span class="n">normal</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="mf">.975</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">normal</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">blur_span</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="o">/</span> <span class="n">normal</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
        
        <span class="c1"># compute the mask value, adjusting each rho value to be distance from blur_radius</span>
        <span class="c1"># and then using the normal distribution to drop contrast graduate from zero beyond that</span>
        <span class="c1"># radius; afterwards reset everything within blur radius to 1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">rho</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">blur_radius</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span> <span class="o">/</span> <span class="n">normal</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">rho</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_radius</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pil_mask</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
<div class="viewcode-block" id="CircularMask.draw_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.CircularMask.draw_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">draw_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_tensor</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">new_ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        
        <span class="c1"># make sure spatial dimensions of mask match batch</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">!=</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_size</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gen_mask</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">device</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="CircularMask.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.CircularMask.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_params</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="CircularMask.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.CircularMask.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="CircularMask.replay">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.CircularMask.replay">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">replay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">apply_mask</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">])</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">apply_mask</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">format_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>  
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;p=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, output_size=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_size</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, blur_span=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blur_span</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s1">&#39;, tol=</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">)</span>
        <span class="n">format_string</span> <span class="o">+=</span> <span class="s2">&quot;, device=&#39;</span><span class="si">{0}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_string</span></div>


<span class="c1"># =================================================</span>
<span class="c1">#  RandomSolarization</span>
<span class="c1"># =================================================</span>

<div class="viewcode-block" id="RandomSolarization">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomSolarization">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomSolarization</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solarize the image randomly with a given probability by inverting all pixel</span>
<span class="sd">    values above a threshold. If img is a Tensor, it is expected to be in [bs, 1 or 3, H, W] format,</span>
<span class="sd">    where `bs` is the batch size.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        solarization_prob (float): probability of the image being solarized. Default value is 0.5</span>
<span class="sd">        threshold (float): all pixels equal or above this value are inverted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RandomSolarization.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomSolarization.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">device</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_init_rng</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
            
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>        
        
<div class="viewcode-block" id="RandomSolarization.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomSolarization.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_rng</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_batch</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="RandomSolarization.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomSolarization.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomSolarization.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomSolarization.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_solarization</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_solarization</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(p=</span><span class="si">{0}</span><span class="s1">, threshold=</span><span class="si">{1}</span><span class="s1">, seed=</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span> </div>

    
<span class="c1"># =================================================</span>
<span class="c1">#  RandomPatchShuffle</span>
<span class="c1"># =================================================</span>
    
<div class="viewcode-block" id="RandomPatchShuffle">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomPatchShuffle">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomPatchShuffle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly shuffle an image, dividined into NxN square patches (assumes square images).</span>
<span class="sd">    </span>
<span class="sd">    Operates over a TensorImage (CxHxW) or TensorImageBatch (BxCxHxW).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        sizes: patch size, or list of patch_sizes, in proportion of image size</span>
<span class="sd">        p (float): probability of the image being solarized. Default value is 0.5</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RandomPatchShuffle.__init__">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomPatchShuffle.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sizes</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">img_size</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">sizes</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">img_size</span> <span class="o">=</span> <span class="n">img_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_grids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patches</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_grid_patches</span><span class="p">(</span><span class="n">img_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rand_patch_sizes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rand_grids</span> <span class="o">=</span> <span class="kc">None</span></div>

        
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>        
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_init_grid_patches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">out_size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_grids</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">base_grid</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">),</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">),</span> 
        <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_grids</span><span class="p">[</span><span class="n">out_size</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="n">out_size</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">patch_size_idx</span><span class="p">,</span><span class="n">patch_size_pct</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">):</span>
            <span class="n">patch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">patch_size_pct</span> <span class="o">*</span> <span class="n">out_size</span><span class="p">)</span>
            <span class="n">patches</span> <span class="o">=</span> <span class="n">base_grid</span><span class="o">.</span><span class="n">unfold</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span><span class="o">.</span><span class="n">unfold</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span>
            <span class="n">patches</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">patch_size</span><span class="p">,</span><span class="n">patch_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="n">out_size</span><span class="p">][</span><span class="n">patch_size</span><span class="p">]</span> <span class="o">=</span> <span class="n">patches</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_grid_patches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out_size</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">out_size</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_grids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_grid_patches</span><span class="p">(</span><span class="n">out_size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="n">out_size</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="n">out_size</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">non_blocking</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="n">out_size</span><span class="p">]</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_shuffled_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">rand_patch_sizes</span><span class="p">):</span>
        <span class="n">H</span><span class="p">,</span><span class="n">W</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">assert</span> <span class="n">H</span><span class="o">==</span><span class="n">W</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;RandomPatchShuffle requires square inputs, got H=</span><span class="si">{</span><span class="n">H</span><span class="si">}</span><span class="s2">, W=</span><span class="si">{</span><span class="n">W</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">img_size</span> <span class="o">=</span> <span class="n">H</span>
        
        <span class="c1"># get the un-shuffled patches for this image size</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grid_patches</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">patch_size</span> <span class="ow">in</span> <span class="n">patches</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">H</span><span class="o">%</span><span class="n">patch_size</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Patch size (</span><span class="si">{</span><span class="n">patch_size</span><span class="si">}</span><span class="s2">) must divide evenly into image size (</span><span class="si">{</span><span class="n">img_size</span><span class="si">}</span><span class="s2">)&quot;</span>
        
        <span class="c1"># scramble image</span>
        <span class="c1"># must loop over the different patch sizes</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rand_patch_sizes</span><span class="p">),</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">patch_size_pct</span> <span class="ow">in</span> <span class="n">rand_patch_sizes</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
            <span class="n">patch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">patch_size_pct</span> <span class="o">*</span> <span class="n">img_size</span><span class="p">)</span>
            <span class="c1"># patch_size_idx = self.sizes.index(patch_size)</span>
            <span class="c1"># get index for all images with this patch_size:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rand_patch_sizes</span><span class="o">==</span><span class="n">patch_size_pct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="c1"># get random patch permutation for each image</span>
            <span class="n">n_patches</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">H</span><span class="o">/</span><span class="n">patch_size</span><span class="p">)</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">W</span><span class="o">/</span><span class="n">patch_size</span><span class="p">)</span>
            <span class="n">shuffled_patch_idxs</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">generate_batch_permutations</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc</span><span class="p">),</span> <span class="n">n_patches</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">shuffled_patches</span> <span class="o">=</span> <span class="n">patches</span><span class="p">[</span><span class="n">patch_size</span><span class="p">][</span><span class="n">shuffled_patch_idxs</span><span class="p">]</span>
            
            <span class="c1"># prepare for folding by reshaping from (B, N*N, C, pH, pW) to (B, C*pH*pW, N*N)</span>
            <span class="n">B</span><span class="p">,</span> <span class="n">nP</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">pH</span><span class="p">,</span> <span class="n">pW</span> <span class="o">=</span> <span class="n">shuffled_patches</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">input_patches</span> <span class="o">=</span> <span class="n">shuffled_patches</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">C</span> <span class="o">*</span> <span class="n">pH</span> <span class="o">*</span> <span class="n">pW</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># fold shuffled_patches back to img_size</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">fold</span><span class="p">(</span><span class="n">input_patches</span><span class="p">,</span> 
                                              <span class="n">output_size</span><span class="o">=</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">),</span> 
                                              <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">),</span>
                                              <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">))</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># B x H x W x 2</span>
            
            <span class="n">grid</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
        
        <span class="k">return</span> <span class="n">grid</span>
    
<div class="viewcode-block" id="RandomPatchShuffle.random_choice">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomPatchShuffle.random_choice">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">random_choice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)]</span> </div>


<div class="viewcode-block" id="RandomPatchShuffle.before_call">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomPatchShuffle.before_call">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">before_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s2">&quot;before_call the state for input `b`&quot;</span>
        <span class="c1"># determine which images to shuffle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mask_batch</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        
        <span class="c1"># get random patch size for each to-be-shuffled image</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">rand_patch_idxs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rand_patch_sizes</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">rand_patch_idxs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rand_grids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_shuffled_grids</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rand_patch_sizes</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="RandomPatchShuffle.last_params">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomPatchShuffle.last_params">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;do&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do</span><span class="p">,</span> <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;rand_patch_sizes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rand_patch_sizes</span><span class="p">,</span> <span class="s2">&quot;rand_grids&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rand_grids</span><span class="p">}</span></div>

    
<div class="viewcode-block" id="RandomPatchShuffle.apply_last">
<a class="viewcode-back" href="../../../../api/foveation.utils.fastaugs.transforms.html#foveation.utils.fastaugs.transforms.RandomPatchShuffle.apply_last">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_last</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_params</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_grid_sample</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rand_grids&#39;</span><span class="p">],</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">before_call</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_last</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s1">&#39;(p=</span><span class="si">{0}</span><span class="s1">, sizes=</span><span class="si">{1}</span><span class="s1">, seed=</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span> </div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>